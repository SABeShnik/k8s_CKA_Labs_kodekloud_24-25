1. Objectives 
HPA with Imperative commands 
Requirements for HPA to work 
What happens when resources.limit is not mentioned - Ok -

Цели 
HPA с императивными командами 
Требования к HPA для работы 
Что произойдет, 
если параметр resources.limit не указан



2. Create a Deployment
Using the /root/deployment.yml manifest file provided , create a Kubernetes deployment 
for the nginx application.
Click on Skooner to access the monitoring tool and view the resources in the Kubernetes cluster.
Token for the Skooner can be found in /root/skooner-sa-token.txt

controlplane ~ ✖ kubectl apply -f /root/deployment.yml
deployment.apps/nginx-deployment created

Hint:
To deploy nginx application, run the below command.
kubectl apply -f /root/deployment.yml

To view the deployment and pods creation, use the below commands.
kubectl get deploy or kubectl get pods



3. We have a manifest file to create autoscaling for the Nginx deployment located at /root/autoscale.yml. 
Review the manifest file and identify the current replicas and desired replicas?

A. Current replicas= 7
    Desired replicas= 3

B. Current replicas= 3
    Desired replicas= 7

C. Current replicas= 7
    Desired replicas= 1

D. Current replicas= 0    <-----------------------------
    Desired replicas= 0   <-----------------------------




4. Create an autoscaler for the nginx-deployment with a maximum of 3 replicas and a CPU utilization target of 80%.

Hint:
Run the imperative command to create autoscale:

kubectl autoscale deployment nginx-deployment --max=3 --cpu=80%
Or use the /root/autoscale.yml manifest file to create autoscale.
kubectl apply -f /root/autoscale.yml

controlplane ~ ➜  kubectl autoscale deployment nginx-deployment --max=3 --cpu=80%
horizontalpodautoscaler.autoscaling/nginx-deployment autoscaled



5. What is the primary purpose of the Horizontal Pod Autoscaler (HPA) in Kubernetes?
- To automate the creation of services
- To automate the scaling of cluster nodes
- To automate the scaling of pods based on observed CPU utilization or other select metrics <----
- To automate the deployment of new applications

Hint:
The primary purpose of the HPA is to automatically adjust the number of pod replicas in a deployment, replication controller, or replica set based on observed metrics such as CPU utilization or custom metrics provided by the metrics server.




6. What component in a Kubernetes cluster is responsible for providing metrics to the HPA?

Answer = metrics-server

Hint:
The metrics-server is a cluster-wide aggregator of resource usage data, and it provides the metrics required by the HPA to make scaling decisions.



7. What is the current replica count of nginx-deployment after deploying the autoscaler?
controlplane ~ ➜  kubectl get deployments.apps 
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   3/3     3            3           17m



8. What is the status of HPA target?


Hint:
Run the below command to find HPA target
controlplane ~ ➜  kubectl get hpa
NAME               REFERENCE                     TARGETS         MINPODS   MAXPODS   REPLICAS   AGE
nginx-deployment   Deployment/nginx-deployment   <unknown


controlplane ~ ➜  kubectl get hpa
NAME               REFERENCE                     TARGETS              MINPODS   MAXPODS   REPLICAS   AGE
nginx-deployment   Deployment/nginx-deployment   cpu: <unknown>/80%   1         3         3          10m

Answer = <unknown>/80%




9. The HPA status shows /80 for the CPU target. what could be a possible reason?

- The deployment does not have any resource fields defined. <------------------
- The nodes are out of capacity.
- The metrics server is not available or not functioning properly.
- The Kubernetes cluster is not using namespaces.

Hint:
If the status of the Horizontal Pod Autoscaler (HPA) target is <UNKNOWN>/80, 
it typically means that the HPA is unable to retrieve the current metrics for the specified target. 
Run kubectl describe hpa nginx-deployment to find more details.

Metrics:                                               ( current / target )
  resource cpu on pods  (as a percentage of request):  <unknown> / 80%



10. Since the HPA was failing due to the resource field missing in the nginx-deployment, the resource field has been updated in /root/deployment.yml. Update the nginx-deployment using this manifest. Watch the changes made to the nginx-deployment by the HPA after upgrading by using the kubectl get hpa --watch command.

Hint:
To update the nginx-deployment, run the below command:

kubectl apply -f /root/deployment.yml
To watch the changes made to the nginx-deployment by the HPA, use the below command:

kubectl get hpa --watch

controlplane ~ ✖ kubectl get hpa --watch
NAME               REFERENCE                     TARGETS       MINPODS   MAXPODS   REPLICAS   AGE
nginx-deployment   Deployment/nginx-deployment   cpu: 0%/80%   1         3         1          21m



11. What does the event ScalingReplicaSet in the nginx-deployment HPA indicate?

What is the cause of the FailedGetResourceMetric event in the nginx-deployment HPA?

The node has reached its process limit.



